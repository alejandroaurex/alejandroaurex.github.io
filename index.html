<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Star Hats Club - Checkout Oficial</title>
    <!-- Carga de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Carga de la fuente Geist -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Geist:wght@100;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        /* ===============================================
           STAR HATS PREMIUM DESIGN SYSTEM V2
           =============================================== */
        
        /* Animaciones Base */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) translateX(0px); }
            33% { transform: translateY(-8px) translateX(4px); }
            66% { transform: translateY(-4px) translateX(-4px); }
        }

        @keyframes goldPulse {
            0%, 100% { opacity: 0.15; }
            50% { opacity: 0.25; }
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        body {
            font-family: 'Geist', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: #000000;
            color: #f3f4f6;
            animation: fadeIn 1s ease-out;
            overflow-x: hidden;
            scroll-behavior: smooth;
            -webkit-font-smoothing: antialiased;
        }
        
        /* Background Premium */
        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background-image: radial-gradient(circle at 2px 2px, #D4AF37 1.5px, transparent 0);
            background-size: 24px 24px;
            opacity: 0.15;
            pointer-events: none;
            z-index: -1;
            animation: float 12s ease-in-out infinite, goldPulse 8s ease-in-out infinite;
        }

        /* Contenedor del formulario */
        .form-container {
            background: linear-gradient(145deg, rgba(26, 26, 26, 0.95) 0%, rgba(10, 10, 10, 0.98) 100%);
            border: 1px solid rgba(212, 175, 55, 0.2);
            border-radius: 20px;
            box-shadow: 
                0 0 60px rgba(212, 175, 55, 0.15),
                0 20px 60px rgba(0, 0, 0, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            position: relative;
            overflow: hidden;
        }

        .form-container::before {
            content: '';
            position: absolute;
            top: 0; left: -100%; width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(212, 175, 55, 0.05), transparent);
            animation: shimmer 8s ease-in-out infinite;
            z-index: 0;
        }

        .form-container > * { position: relative; z-index: 1; }

        /* Inputs Premium */
        .form-input {
            background-color: rgba(5, 5, 5, 0.8);
            border: 1.5px solid rgba(68, 68, 68, 0.6);
            color: #f3f4f6;
            border-radius: 10px;
            padding: 14px 16px;
            width: 100%;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 15px;
            font-weight: 500;
        }
        
        .form-input:hover {
            border-color: rgba(212, 175, 55, 0.4);
            background-color: rgba(10, 10, 10, 0.9);
        }
        
        .form-input:focus {
            outline: none;
            border-color: #D4AF37;
            background-color: rgba(15, 15, 15, 0.95);
            box-shadow: 0 0 0 4px rgba(212, 175, 55, 0.15);
            transform: translateY(-1px);
        }
        
        .form-input::placeholder { color: #71717a; font-weight: 400; }
        
        /* Labels */
        label { font-weight: 600; letter-spacing: 0.02em; }

        /* Tabs */
        .tab-button {
            background-color: rgba(17, 17, 17, 0.8);
            color: #888;
            border: 1px solid rgba(51, 51, 51, 0.5);
            border-radius: 10px;
            padding: 12px 24px;
            font-weight: 600;
            font-size: 15px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .tab-button.active {
            background: linear-gradient(135deg, #D4AF37 0%, #E6C96C 100%);
            color: #0a0a0a;
            font-weight: 700;
            border-color: transparent;
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.3);
        }

        /* Bot√≥n Principal */
        .submit-button {
            background: linear-gradient(135deg, #D4AF37 0%, #E6C96C 50%, #D4AF37 100%);
            background-size: 200% 100%;
            color: #0a0a0a;
            font-weight: 800;
            padding: 16px 24px;
            border-radius: 12px;
            width: 100%;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            font-size: 14px;
            box-shadow: 0 0 30px rgba(212, 175, 55, 0.3);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            border: none;
            display: flex; align-items: center; justify-content: center;
        }
        
        .submit-button:hover {
            background-position: 100% 0;
            box-shadow: 0 0 50px rgba(212, 175, 55, 0.5);
            transform: translateY(-3px) scale(1.02);
        }

        .submit-button:disabled { opacity: 0.7; cursor: not-allowed; transform: none; }

        /* Bot√≥n Secundario */
        .secondary-button {
            background-color: rgba(34, 34, 34, 0.8);
            color: #f4f4f4;
            border: 1px solid rgba(68, 68, 68, 0.6);
            border-radius: 10px;
            font-weight: 600;
            padding: 14px 24px;
            transition: all 0.3s;
        }
        .secondary-button:hover {
            border-color: #D4AF37;
            color: #D4AF37;
        }

        /* Separadores y T√≠tulos */
        .section-title { position: relative; padding-bottom: 16px; margin-bottom: 24px; }
        .section-title::after {
            content: ''; position: absolute; bottom: 0; left: 0; width: 60px; height: 3px;
            background: linear-gradient(90deg, #D4AF37, transparent); border-radius: 2px;
        }
        .premium-divider {
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(212, 175, 55, 0.3), transparent);
            margin: 32px 0;
        }

        /* Carrito */
        #total-price {
            background: linear-gradient(135deg, #D4AF37, #E6C96C);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 900;
        }
        .cart-item {
            transition: all 0.3s;
            position: relative;
            background-color: rgba(20, 20, 20, 0.8);
            border: 1px solid rgba(50, 50, 50, 0.5);
        }
        .cart-item:hover {
            border-color: rgba(212, 175, 55, 0.3);
            transform: translateX(4px);
        }

        /* SELECTOR DE PRODUCTOS PREMIUM */
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            gap: 12px;
            margin-top: 8px;
        }

        .product-card {
            background: rgba(30, 30, 30, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 10px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
            text-align: left;
        }

        .product-card:hover {
            transform: translateY(-4px);
            border-color: rgba(212, 175, 55, 0.5);
            background: rgba(40, 40, 40, 0.9);
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
        }

        .product-card.selected {
            border-color: #D4AF37;
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.1), rgba(10, 10, 10, 0.8));
            box-shadow: 0 0 0 2px rgba(212, 175, 55, 0.3);
        }

        .product-image-container {
            width: 100%;
            aspect-ratio: 1/1;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 8px;
            border: 1px solid rgba(255,255,255,0.05);
            position: relative;
        }

        .product-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s;
        }

        .product-card:hover img { transform: scale(1.1); }

        .product-info h4 {
            font-size: 13px;
            font-weight: 600;
            color: #fff;
            margin-bottom: 2px;
            line-height: 1.2;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .product-info p {
            font-size: 12px;
            color: #D4AF37;
            font-weight: 700;
            margin-top: 4px;
        }

        .check-badge, .add-badge {
            position: absolute;
            background: #D4AF37;
            color: black;
            border-radius: 50%;
            width: 22px;
            height: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }
        .check-badge { top: 8px; right: 8px; opacity: 0; transform: scale(0); transition: all 0.3s; }
        .product-card.selected .check-badge { opacity: 1; transform: scale(1); }
        .add-badge { bottom: 8px; right: 8px; background: rgba(0,0,0,0.6); color: white; border: 1px solid rgba(255,255,255,0.2); transition: all 0.2s; }
        .product-card:hover .add-badge { background: #D4AF37; color: black; border-color: transparent; }


        /* --- NUEVO ESTILO DE UPLOAD PREMIUM --- */
        .upload-box {
            border: 2px dashed rgba(68, 68, 68, 0.6);
            background-color: rgba(10, 10, 10, 0.5);
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .upload-box:hover {
            border-color: #D4AF37;
            background-color: rgba(20, 20, 20, 0.8);
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        .upload-content {
            pointer-events: none; /* Dejar pasar clics al contenedor */
            transition: opacity 0.3s;
        }

        .upload-icons {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 24px;
            margin-bottom: 16px;
        }

        .upload-icon-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            opacity: 0.8;
            transition: transform 0.3s, opacity 0.3s;
        }
        
        .upload-box:hover .upload-icon-item {
            opacity: 1;
            transform: translateY(-2px);
        }

        .upload-icon-circle {
            width: 56px;
            height: 56px;
            background: rgba(255,255,255,0.05);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px;
            border: 1px solid rgba(255,255,255,0.1);
            position: relative;
        }
        
        .upload-box:hover .upload-icon-circle {
            border-color: rgba(212, 175, 55, 0.4);
            background: rgba(212, 175, 55, 0.05);
        }

        .upload-text-main {
            font-weight: 700;
            font-size: 15px;
            color: #f3f4f6;
            margin-bottom: 4px;
        }

        .upload-text-sub {
            font-size: 13px;
            color: #888;
        }

        .hidden-file-input { display: none; }

        .preview-container {
            display: none;
            text-align: center;
            animation: fadeIn 0.3s;
        }

        .preview-img {
            max-height: 280px;
            width: auto;
            margin: 0 auto;
            border-radius: 12px;
            border: 2px solid rgba(34, 197, 94, 0.5); /* Borde verde al subir */
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .change-file-btn {
            margin-top: 16px;
            background: rgba(30,30,30,0.8);
            border: 1px solid rgba(255,255,255,0.1);
            color: #ccc;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
        }

        .change-file-btn:hover {
            background: rgba(50,50,50,0.9);
            color: white;
            border-color: rgba(212, 175, 55, 0.5);
            transform: translateY(-1px);
        }

        /* Loading Spinner */
        .loading-spinner {
            border: 3px solid rgba(212, 175, 55, 0.2);
            border-top: 3px solid #000;
            border-radius: 50%;
            width: 24px; height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Modals */
        .modal-backdrop { backdrop-filter: blur(12px); background-color: rgba(0, 0, 0, 0.85); }
        .modal-content { animation: modalSlideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        @keyframes modalSlideIn {
            from { opacity: 0; transform: translateY(30px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        /* Responsive */
        @media (max-width: 640px) {
            .form-container { padding: 24px !important; }
            .product-grid { grid-template-columns: repeat(2, 1fr); }
            .upload-icons { gap: 16px; }
            .upload-icon-circle { width: 48px; height: 48px; }
        }
    </style>
</head>
<body class="antialiased">

    <!-- Contenedor Principal -->
    <div class="min-h-screen w-full px-4 py-8 md:py-12">

        <!-- Header con Logo -->
        <header class="max-w-md mx-auto mb-10 text-center relative z-10">
            <img src="https://i.imgur.com/Rkx03XV.png" alt="Star Hats Club Logo" class="w-48 h-auto mx-auto drop-shadow-2xl hover:scale-105 transition-transform duration-500"
                 onerror="this.onerror=null; this.src='https://placehold.co/200x200/000000/FFFFFF?text=Star+Hats+Club';">
        </header>

        <!-- Contenedor del Formulario -->
        <main class="max-w-3xl mx-auto p-6 sm:p-8 md:p-10 form-container">

            <!-- Selector de Pesta√±as -->
            <div class="mb-8 p-1.5 bg-black/40 rounded-xl grid grid-cols-2 gap-2">
                <button id="tab-pagos" class="tab-button active">
                    <i data-lucide="credit-card" class="inline-block w-4 h-4 mr-1.5"></i>
                    Pago Completo
                </button>
                <button id="tab-apartados" class="tab-button">
                    <i data-lucide="calendar-check" class="inline-block w-4 h-4 mr-1.5"></i>
                    Apartado
                </button>
            </div>

            <!-- Contenido de Pesta√±as -->
            <div>
                <!-- SECCI√ìN DE PAGO COMPLETO -->
                <div id="content-pagos">
                    <form id="form-pago" class="space-y-6">
                        
                        <!-- 1. Datos Personales -->
                        <h2 class="text-2xl font-bold text-white section-title">1. Tus Datos</h2>
                        <div class="space-y-4">
                            <!-- Nombre -->
                            <div>
                                <label for="nombre-pago" class="block text-sm font-medium text-gray-300 mb-2">Nombre Completo *</label>
                                <input type="text" id="nombre-pago" class="form-input" placeholder="Nombre y Apellidos" required>
                            </div>
                            
                            <!-- Instagram -->
                            <div>
                                <label for="instagram-pago" class="block text-sm font-medium text-gray-300 mb-2">Username de Instagram</label>
                                <input type="text" id="instagram-pago" class="form-input" placeholder="@tu_usuario">
                            </div>

                            <!-- Emails -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="email-pago" class="block text-sm font-medium text-gray-300 mb-2">Correo Electr√≥nico *</label>
                                    <input type="email" id="email-pago" class="form-input" placeholder="tu@correo.com" required>
                                </div>
                                <div>
                                    <label for="confirm-email-pago" class="block text-sm font-medium text-gray-300 mb-2">Confirma tu Correo *</label>
                                    <input type="email" id="confirm-email-pago" class="form-input" placeholder="Escr√≠belo de nuevo" required>
                                </div>
                            </div>

                            <!-- Tel√©fono -->
                            <div>
                                <label for="telefono-pago" class="block text-sm font-medium text-gray-300 mb-2">Tel√©fono (WhatsApp) *</label>
                                <input type="tel" id="telefono-pago" class="form-input" placeholder="Ej. 33 1234 5678" required>
                            </div>

                            <!-- Direcci√≥n Mejorada (Grid) -->
                            <div class="pt-4">
                                <label class="block text-sm font-bold text-yellow-500 mb-3 uppercase tracking-wide">Direcci√≥n de Env√≠o</label>
                                <div class="grid grid-cols-1 md:grid-cols-6 gap-4">
                                    <div class="md:col-span-4">
                                        <label for="addr-calle" class="block text-xs font-medium text-gray-400 mb-1">Calle *</label>
                                        <input type="text" id="addr-calle" class="form-input" placeholder="Nombre de la calle" required>
                                    </div>
                                    <div class="md:col-span-1">
                                        <label for="addr-ext" class="block text-xs font-medium text-gray-400 mb-1">No. Ext *</label>
                                        <input type="text" id="addr-ext" class="form-input" placeholder="123" required>
                                    </div>
                                    <div class="md:col-span-1">
                                        <label for="addr-int" class="block text-xs font-medium text-gray-400 mb-1">No. Int</label>
                                        <input type="text" id="addr-int" class="form-input" placeholder="A-2">
                                    </div>
                                    <div class="md:col-span-3">
                                        <label for="addr-colonia" class="block text-xs font-medium text-gray-400 mb-1">Colonia *</label>
                                        <input type="text" id="addr-colonia" class="form-input" placeholder="Colonia" required>
                                    </div>
                                    <div class="md:col-span-3">
                                        <label for="addr-cp" class="block text-xs font-medium text-gray-400 mb-1">C√≥digo Postal *</label>
                                        <input type="text" id="addr-cp" class="form-input" placeholder="00000" required>
                                    </div>
                                    <div class="md:col-span-3">
                                        <label for="addr-ciudad" class="block text-xs font-medium text-gray-400 mb-1">Ciudad / Municipio *</label>
                                        <input type="text" id="addr-ciudad" class="form-input" placeholder="Ciudad" required>
                                    </div>
                                    <div class="md:col-span-3">
                                        <label for="addr-estado" class="block text-xs font-medium text-gray-400 mb-1">Estado *</label>
                                        <select id="addr-estado" class="form-input" required>
                                            <option value="">Selecciona Estado</option>
                                            <option value="Aguascalientes">Aguascalientes</option>
                                            <option value="Baja California">Baja California</option>
                                            <option value="Baja California Sur">Baja California Sur</option>
                                            <option value="Campeche">Campeche</option>
                                            <option value="Chiapas">Chiapas</option>
                                            <option value="Chihuahua">Chihuahua</option>
                                            <option value="CDMX">Ciudad de M√©xico</option>
                                            <option value="Coahuila">Coahuila</option>
                                            <option value="Colima">Colima</option>
                                            <option value="Durango">Durango</option>
                                            <option value="Estado de M√©xico">Estado de M√©xico</option>
                                            <option value="Guanajuato">Guanajuato</option>
                                            <option value="Guerrero">Guerrero</option>
                                            <option value="Hidalgo">Hidalgo</option>
                                            <option value="Jalisco">Jalisco</option>
                                            <option value="Michoac√°n">Michoac√°n</option>
                                            <option value="Morelos">Morelos</option>
                                            <option value="Nayarit">Nayarit</option>
                                            <option value="Nuevo Le√≥n">Nuevo Le√≥n</option>
                                            <option value="Oaxaca">Oaxaca</option>
                                            <option value="Puebla">Puebla</option>
                                            <option value="Quer√©taro">Quer√©taro</option>
                                            <option value="Quintana Roo">Quintana Roo</option>
                                            <option value="San Luis Potos√≠">San Luis Potos√≠</option>
                                            <option value="Sinaloa">Sinaloa</option>
                                            <option value="Sonora">Sonora</option>
                                            <option value="Tabasco">Tabasco</option>
                                            <option value="Tamaulipas">Tamaulipas</option>
                                            <option value="Tlaxcala">Tlaxcala</option>
                                            <option value="Veracruz">Veracruz</option>
                                            <option value="Yucat√°n">Yucat√°n</option>
                                            <option value="Zacatecas">Zacatecas</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="premium-divider"></div>

                        <!-- 2. Tu Pedido -->
                        <h2 class="text-2xl font-bold text-white section-title">2. Selecci√≥n de Productos</h2>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Haz clic para agregar al carrito:</label>
                            <div id="product-grid-pago" class="product-grid">
                                <!-- Cards generadas por JS -->
                            </div>
                        </div>
                        
                        <div id="cart-summary" class="space-y-3 mt-4">
                            <!-- Items del carrito -->
                        </div>

                        <div id="total-container" class="pt-6 border-t border-gray-700/50 text-right" style="display: none;">
                            <p class="text-3xl font-extrabold text-white">
                                Total: <span id="total-price">$0.00 MXN</span>
                            </p>
                        </div>

                        <div class="premium-divider"></div>

                        <!-- 3. Comprobante (NUEVA ZONA DE CARGA) -->
                        <h2 class="text-2xl font-bold text-white section-title">3. Confirmaci√≥n</h2>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-3">Sube tu Comprobante de Pago *</label>
                            
                            <div class="upload-box" id="upload-box-pago">
                                <input type="file" id="comprobante-pago" class="hidden-file-input" accept="image/png, image/jpeg, .heic" required>
                                
                                <!-- Estado Inicial -->
                                <div class="upload-content" id="upload-placeholder-pago">
                                    <div class="upload-icons">
                                        <!-- Icono Ticket -->
                                        <div class="upload-icon-item">
                                            <div class="upload-icon-circle">
                                                <i data-lucide="receipt" class="text-yellow-500 w-7 h-7"></i>
                                            </div>
                                            <span class="text-xs font-semibold text-gray-400">Ticket F√≠sico</span>
                                        </div>
                                        <!-- Separador -->
                                        <div class="h-12 w-px bg-gray-700/50"></div>
                                        <!-- Icono Screenshot -->
                                        <div class="upload-icon-item">
                                            <div class="upload-icon-circle">
                                                <i data-lucide="smartphone" class="text-yellow-500 w-7 h-7"></i>
                                            </div>
                                            <span class="text-xs font-semibold text-gray-400">Transferencia</span>
                                        </div>
                                    </div>
                                    <p class="upload-text-main">Toca aqu√≠ para subir Foto o Screenshot</p>
                                    <p class="upload-text-sub">Aceptamos: PNG, JPG, HEIC</p>
                                </div>

                                <!-- Estado Preview -->
                                <div class="preview-container" id="preview-container-pago">
                                    <img id="preview-img-pago" src="" class="preview-img">
                                    <button type="button" class="change-file-btn" id="change-file-pago">
                                        <i data-lucide="refresh-cw" class="w-4 h-4 mr-2"></i> Cambiar imagen
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div id="error-message-pago" class="text-red-400 text-sm font-medium bg-red-500/10 p-4 rounded-lg border border-red-500/20" style="display: none;"></div>

                        <button type="submit" class="submit-button group mt-6">
                            <span class="button-text inline-flex items-center">
                                <i data-lucide="send" class="inline-block w-5 h-5 mr-2 group-hover:translate-x-1 transition-transform"></i>
                                Confirmar Pedido
                            </span>
                            <div class="loading-spinner mx-auto" style="display: none;"></div>
                        </button>
                        
                        <p class="text-xs text-gray-500 text-center mt-3">
                            * Se generar√° un n√∫mero de orden provisional.
                        </p>
                    </form>
                </div>

                <!-- SECCI√ìN DE APARTADOS -->
                <div id="content-apartados" style="display: none;">
                    <form id="form-apartado" class="space-y-6">
                        <div class="bg-yellow-500/10 border-l-4 border-yellow-500 p-4 rounded text-sm text-gray-300">
                            <i data-lucide="info" class="inline-block w-4 h-4 mr-1 text-yellow-500"></i>
                            Usa esta secci√≥n solo si vas a realizar un <strong>apartado</strong> de producto.
                        </div>
                        
                        <!-- 1. Datos Personales -->
                        <h2 class="text-2xl font-bold text-white section-title">1. Tus Datos</h2>
                        <div class="space-y-4">
                            <div>
                                <label for="nombre-apartado" class="block text-sm font-medium text-gray-300 mb-2">Nombre Completo *</label>
                                <input type="text" id="nombre-apartado" class="form-input" required>
                            </div>
                            <div>
                                <label for="instagram-apartado" class="block text-sm font-medium text-gray-300 mb-2">Instagram</label>
                                <input type="text" id="instagram-apartado" class="form-input" placeholder="@tu_usuario">
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="email-apartado" class="block text-sm font-medium text-gray-300 mb-2">Correo *</label>
                                    <input type="email" id="email-apartado" class="form-input" required>
                                </div>
                                <div>
                                    <label for="confirm-email-apartado" class="block text-sm font-medium text-gray-300 mb-2">Confirma Correo *</label>
                                    <input type="email" id="confirm-email-apartado" class="form-input" required>
                                </div>
                            </div>
                            <div>
                                <label for="telefono-apartado" class="block text-sm font-medium text-gray-300 mb-2">Tel√©fono *</label>
                                <input type="tel" id="telefono-apartado" class="form-input" required>
                            </div>
                        </div>

                        <div class="premium-divider"></div>

                        <!-- 2. Selecci√≥n -->
                        <h2 class="text-2xl font-bold text-white section-title">2. Producto a Apartar</h2>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Selecciona la gorra para reservar:</label>
                            <div id="product-grid-apartado" class="product-grid">
                                <!-- Cards generadas por JS -->
                            </div>
                            <input type="hidden" id="selected-hat-apartado-id" required>
                        </div>
                        
                        <div class="premium-divider"></div>

                        <!-- 3. Comprobante (NUEVA ZONA DE CARGA) -->
                        <h2 class="text-2xl font-bold text-white section-title">3. Confirmaci√≥n</h2>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-3">Sube tu Comprobante de Apartado *</label>
                            
                            <div class="upload-box" id="upload-box-apartado">
                                <input type="file" id="comprobante-apartado" class="hidden-file-input" accept="image/png, image/jpeg, .heic" required>
                                
                                <!-- Estado Inicial -->
                                <div class="upload-content" id="upload-placeholder-apartado">
                                    <div class="upload-icons">
                                        <!-- Icono Ticket -->
                                        <div class="upload-icon-item">
                                            <div class="upload-icon-circle">
                                                <i data-lucide="receipt" class="text-yellow-500 w-7 h-7"></i>
                                            </div>
                                            <span class="text-xs font-semibold text-gray-400">Ticket F√≠sico</span>
                                        </div>
                                        <!-- Separador -->
                                        <div class="h-12 w-px bg-gray-700/50"></div>
                                        <!-- Icono Screenshot -->
                                        <div class="upload-icon-item">
                                            <div class="upload-icon-circle">
                                                <i data-lucide="smartphone" class="text-yellow-500 w-7 h-7"></i>
                                            </div>
                                            <span class="text-xs font-semibold text-gray-400">Transferencia</span>
                                        </div>
                                    </div>
                                    <p class="upload-text-main">Toca aqu√≠ para subir Foto o Screenshot</p>
                                    <p class="upload-text-sub">Aceptamos: PNG, JPG, HEIC</p>
                                </div>

                                <!-- Estado Preview -->
                                <div class="preview-container" id="preview-container-apartado">
                                    <img id="preview-img-apartado" src="" class="preview-img">
                                    <button type="button" class="change-file-btn" id="change-file-apartado">
                                        <i data-lucide="refresh-cw" class="w-4 h-4 mr-2"></i> Cambiar imagen
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div id="error-message-apartado" class="text-red-400 text-sm font-medium bg-red-500/10 p-4 rounded-lg border border-red-500/20" style="display: none;"></div>
                        
                        <button type="submit" class="submit-button group mt-6">
                            <span class="button-text inline-flex items-center">
                                <i data-lucide="send" class="inline-block w-5 h-5 mr-2 group-hover:translate-x-1 transition-transform"></i>
                                Confirmar Apartado
                            </span>
                            <div class="loading-spinner mx-auto" style="display: none;"></div>
                        </button>
                    </form>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal de Cantidad -->
    <div id="quantity-modal" class="fixed inset-0 modal-backdrop flex items-center justify-center p-4" style="display: none; z-index: 50;">
        <div class="form-container modal-content w-full max-w-sm p-6">
            <h3 id="modal-hat-name" class="text-xl font-semibold text-white mb-2">Nombre</h3>
            <p id="modal-hat-price" class="text-lg text-yellow-500 mb-4 font-bold">$0.00</p>
            <img id="modal-hat-image" src="" alt="Producto" class="w-full h-48 object-cover rounded-lg mb-4 border border-gray-700">
            
            <div class="mb-6">
                <label for="modal-quantity" class="block text-sm font-medium text-gray-300 mb-2">Cantidad</label>
                <input type="number" id="modal-quantity" class="form-input text-center text-xl font-bold" value="1" min="1" max="5">
            </div>
            
            <div class="grid grid-cols-2 gap-3">
                <button id="modal-cancel-button" class="secondary-button">Cancelar</button>
                <button id="modal-confirm-button" class="bg-white text-black font-bold py-3 px-4 rounded-lg hover:bg-yellow-400 transition-colors">Agregar</button>
            </div>
        </div>
    </div>

    <!-- Modal de √âxito -->
    <div id="success-modal" class="fixed inset-0 modal-backdrop flex items-center justify-center p-4" style="display: none; z-index: 50;">
        <div class="form-container modal-content w-full max-w-md p-8 text-center border-t-4 border-t-yellow-500">
            <div class="w-20 h-20 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-6 shadow-[0_0_20px_rgba(34,197,94,0.4)]">
                <i data-lucide="check" class="text-black w-10 h-10 stroke-[3px]"></i>
            </div>
            <h3 class="text-3xl font-bold text-white mb-2">¬°Recibido, Carnal!</h3>
            <p class="text-gray-400 mb-6">Tu informaci√≥n ha sido enviada.</p>
            
            <div class="bg-white/5 p-4 rounded-lg mb-6 border border-white/10">
                <p class="text-sm text-gray-400 mb-1">Tu n√∫mero de orden <span class="text-yellow-500 font-bold">provisional</span> es:</p>
                <p id="success-order-number" class="text-2xl font-mono font-bold text-white tracking-wider">Loading...</p>
            </div>

            <div class="text-sm text-left bg-blue-500/10 p-4 rounded border border-blue-500/20 mb-6">
                <p class="text-blue-200">
                    <i data-lucide="info" class="inline-block w-4 h-4 mr-1 align-text-bottom"></i>
                    <strong>Nota Importante:</strong> Este n√∫mero es provisional. El equipo validar√° tu comprobante de transferencia y recibir√°s la confirmaci√≥n oficial en tu correo en menos de 48 hrs.
                </p>
            </div>

            <button id="success-close-button" class="submit-button w-full">Entendido</button>
        </div>
    </div>

    <script>
        // --- Webhook URL ---
        const webhookUrl = "https://n8n.srv840532.hstgr.cloud/webhook/b54d2f6f-05cf-406a-a18d-37a688fecadc";

        // --- NUEVO CAT√ÅLOGO DE PRODUCTOS (V2) ---
        const hatData = [
            { id: 1, name: "NY Colors All Around üóΩüé®", price: 1499.00, image: "https://i.ibb.co/kVQjHnqW/Whats-App-Image-2025-12-22-at-10-36-07.jpg" },
            { id: 2, name: "Triple Red Star ‚ù§Ô∏è‚≠êÔ∏è", price: 1299.00, image: "https://i.ibb.co/WNdnfnr4/Whats-App-Image-2025-12-22-at-10-36-10.jpg" },
            { id: 3, name: "NY Frozen All Around ‚ùÑÔ∏è", price: 1499.00, image: "https://i.ibb.co/B26YXwYS/Whats-App-Image-2025-12-22-at-10-36-08-1.jpg" },
            { id: 4, name: "Total Black District ‚ö´Ô∏è", price: 1499.00, image: "https://i.ibb.co/M525kvry/Gemini-Generated-Image-7v543c7v543c7v54.jpg" },
            { id: 5, name: "Crossbody Leather Star üëú", price: 4499.00, image: "https://i.ibb.co/w3qFsyN/Gemini-Generated-Image-ry6vbnry6vbnry6v.png" },
            { id: 6, name: "Wallet Leather Star üíº", price: 1199.00, image: "https://i.ibb.co/xSrnW6Qp/Gemini-Generated-Image-jpyksqjpyksqjpyk.png" }
        ];

        let cart = [];
        let currentSelectedHatId = null;

        // Generador de C√≥digo de Orden
        function generateOrderNumber(hatName, typePrefix) {
            const prefix = hatName.substring(0, 2).toUpperCase().replace(/[^A-Z]/g, 'X'); 
            const randomDigits = Math.floor(100000 + Math.random() * 900000).toString();
            return `${prefix}${typePrefix}-${randomDigits}`;
        }

        // Formateador de Moneda
        const formatMoney = (amount) => {
            return new Intl.NumberFormat('es-MX', { style: 'currency', currency: 'MXN' }).format(amount);
        };

        document.addEventListener('DOMContentLoaded', () => {
            if (typeof lucide !== 'undefined') lucide.createIcons();

            // Selectores
            const tabPagos = document.getElementById('tab-pagos');
            const tabApartados = document.getElementById('tab-apartados');
            const contentPagos = document.getElementById('content-pagos');
            const contentApartados = document.getElementById('content-apartados');
            
            // Containers Grid
            const gridPago = document.getElementById('product-grid-pago');
            const gridApartado = document.getElementById('product-grid-apartado');
            const hiddenApartadoInput = document.getElementById('selected-hat-apartado-id');

            const quantityModal = document.getElementById('quantity-modal');
            const cartSummary = document.getElementById('cart-summary');
            const totalContainer = document.getElementById('total-container');
            const totalPriceEl = document.getElementById('total-price');

            // --- L√≥gica de Pesta√±as ---
            tabPagos.addEventListener('click', () => {
                if (tabPagos.classList.contains('active')) return;
                tabPagos.classList.add('active');
                tabApartados.classList.remove('active');
                contentPagos.style.display = 'block';
                contentApartados.style.display = 'none';
                if (typeof lucide !== 'undefined') lucide.createIcons();
            });

            tabApartados.addEventListener('click', () => {
                if (tabApartados.classList.contains('active')) return;
                tabApartados.classList.add('active');
                tabPagos.classList.remove('active');
                contentApartados.style.display = 'block';
                contentPagos.style.display = 'none';
                if (typeof lucide !== 'undefined') lucide.createIcons();
            });

            // --- RENDERIZAR GRIDS DE PRODUCTOS ---
            function renderProductGrid(container, isSingleSelection) {
                container.innerHTML = "";
                hatData.forEach(hat => {
                    const card = document.createElement('div');
                    card.className = "product-card group";
                    card.dataset.id = hat.id;
                    
                    // Contenido visual
                    card.innerHTML = `
                        <div class="product-image-container">
                            <img src="${hat.image}" alt="${hat.name}">
                            ${isSingleSelection ? 
                                '<div class="check-badge"><i data-lucide="check" class="w-4 h-4"></i></div>' : 
                                '<div class="add-badge"><i data-lucide="plus" class="w-4 h-4"></i></div>'}
                        </div>
                        <div class="product-info">
                            <h4>${hat.name}</h4>
                            <p>${formatMoney(hat.price)}</p>
                        </div>
                    `;

                    // Event Listener Click
                    card.addEventListener('click', () => {
                        if (isSingleSelection) {
                            // L√≥gica para Apartado (Selecci√≥n √önica)
                            // Remover selected de todos
                            const allCards = container.querySelectorAll('.product-card');
                            allCards.forEach(c => c.classList.remove('selected'));
                            // A√±adir a este
                            card.classList.add('selected');
                            // Actualizar input oculto
                            hiddenApartadoInput.value = hat.id;
                        } else {
                            // L√≥gica para Pago Completo (Abrir Modal de Carrito)
                            openQuantityModal(hat);
                        }
                    });

                    container.appendChild(card);
                });
                
                if (typeof lucide !== 'undefined') lucide.createIcons();
            }

            // Renderizar ambos grids
            renderProductGrid(gridPago, false); // False = Modo Carrito
            renderProductGrid(gridApartado, true); // True = Modo Selecci√≥n √önica

            // --- Modal de Cantidad ---
            function openQuantityModal(hat) {
                currentSelectedHatId = hat.id;
                document.getElementById('modal-hat-name').textContent = hat.name;
                document.getElementById('modal-hat-price').textContent = formatMoney(hat.price);
                document.getElementById('modal-hat-image').src = hat.image;
                document.getElementById('modal-quantity').value = '1';
                quantityModal.style.display = 'flex';
                // Resetear icono
                setTimeout(() => { if (typeof lucide !== 'undefined') lucide.createIcons(); }, 10);
            }

            document.getElementById('modal-cancel-button').addEventListener('click', () => {
                quantityModal.style.display = 'none';
                currentSelectedHatId = null;
            });

            document.getElementById('modal-confirm-button').addEventListener('click', () => {
                const quantity = parseInt(document.getElementById('modal-quantity').value);
                if (quantity < 1 || !currentSelectedHatId) return;

                const hat = hatData.find(h => h.id === currentSelectedHatId);
                const existingItem = cart.find(item => item.id === hat.id);
                
                if (existingItem) {
                    existingItem.quantity += quantity;
                } else {
                    cart.push({ ...hat, quantity });
                }

                updateCartSummary();
                quantityModal.style.display = 'none';
                currentSelectedHatId = null;
            });

            // --- Actualizar Carrito ---
            function updateCartSummary() {
                cartSummary.innerHTML = "";
                let total = 0;

                if (cart.length === 0) {
                    totalContainer.style.display = 'none';
                    return;
                }

                cart.forEach((item, index) => {
                    total += item.price * item.quantity;
                    const itemEl = document.createElement('div');
                    itemEl.className = 'cart-item flex items-center justify-between p-3 rounded-lg mb-2';
                    itemEl.innerHTML = `
                        <div class="flex items-center space-x-3">
                            <img src="${item.image}" class="w-12 h-12 rounded object-cover border border-gray-600">
                            <div>
                                <p class="font-semibold text-white text-sm">${item.name}</p>
                                <p class="text-xs text-gray-400">Cant: ${item.quantity} x ${formatMoney(item.price)}</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-3">
                            <p class="font-bold text-yellow-500 text-sm">${formatMoney(item.price * item.quantity)}</p>
                            <button type="button" class="remove-item-btn text-red-500 hover:text-red-400" data-index="${index}">
                                <i data-lucide="trash-2" class="w-4 h-4"></i>
                            </button>
                        </div>
                    `;
                    cartSummary.appendChild(itemEl);
                });

                // AGREGAR COSTO DE ENV√çO
                const shippingCost = 200;
                total += shippingCost;

                const shippingEl = document.createElement('div');
                shippingEl.className = 'flex items-center justify-between p-3 rounded-lg mb-2 border border-yellow-500/20 bg-yellow-500/5';
                shippingEl.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <i data-lucide="truck" class="w-5 h-5 text-yellow-500"></i>
                        <span class="text-sm font-medium text-gray-300">Gastos de Env√≠o</span>
                    </div>
                    <span class="font-bold text-white text-sm">${formatMoney(shippingCost)}</span>
                `;
                cartSummary.appendChild(shippingEl);

                totalPriceEl.textContent = formatMoney(total);
                totalContainer.style.display = 'block';
                if (typeof lucide !== 'undefined') lucide.createIcons();
            }

            // Eliminar del carrito
            cartSummary.addEventListener('click', (e) => {
                const btn = e.target.closest('.remove-item-btn');
                if (btn) {
                    cart.splice(parseInt(btn.dataset.index), 1);
                    updateCartSummary();
                }
            });

            // --- NUEVA L√ìGICA DE UPLOAD (GRAFICA) ---
            function setupCustomUpload(boxId, inputId, placeholderId, previewContainerId, previewImgId, changeBtnId) {
                const box = document.getElementById(boxId);
                const input = document.getElementById(inputId);
                const placeholder = document.getElementById(placeholderId);
                const previewContainer = document.getElementById(previewContainerId);
                const previewImg = document.getElementById(previewImgId);
                const changeBtn = document.getElementById(changeBtnId);

                // Click en la caja dispara el input
                box.addEventListener('click', () => {
                    input.click();
                });

                // Evitar que el click en "Cambiar" dispare la caja dos veces
                changeBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    input.click();
                });

                input.addEventListener('change', () => {
                    if (input.files && input.files[0]) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            previewImg.src = e.target.result;
                            placeholder.style.display = 'none';
                            previewContainer.style.display = 'block';
                            // Estilo de √©xito
                            box.style.borderColor = 'rgba(34, 197, 94, 0.5)';
                            box.style.backgroundColor = 'rgba(34, 197, 94, 0.05)';
                        }
                        reader.readAsDataURL(input.files[0]);
                    }
                });
            }

            // Inicializar Uploaders
            setupCustomUpload(
                'upload-box-pago', 'comprobante-pago', 'upload-placeholder-pago', 
                'preview-container-pago', 'preview-img-pago', 'change-file-pago'
            );
            setupCustomUpload(
                'upload-box-apartado', 'comprobante-apartado', 'upload-placeholder-apartado', 
                'preview-container-apartado', 'preview-img-apartado', 'change-file-apartado'
            );

            // --- Validaciones y Env√≠o ---
            function validateEmail(id1, id2, errorEl) {
                const e1 = document.getElementById(id1).value;
                const e2 = document.getElementById(id2).value;
                if (e1 !== e2) {
                    errorEl.textContent = "Los correos no coinciden.";
                    errorEl.style.display = 'block';
                    return false;
                }
                return true;
            }

            function validateFile(id, errorEl) {
                const input = document.getElementById(id);
                if (input.files.length === 0) {
                    errorEl.textContent = "Falta subir el comprobante (Foto o Screenshot).";
                    errorEl.style.display = 'block';
                    // Scroll suave hacia el error
                    errorEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    return false;
                }
                if (input.files[0].size > 8 * 1024 * 1024) {
                    errorEl.textContent = "Archivo muy pesado (M√°x 8MB). Intenta con una captura de pantalla.";
                    errorEl.style.display = 'block';
                    return false;
                }
                return true;
            }

            function setLoading(btn, loading) {
                const txt = btn.querySelector('.button-text');
                const spin = btn.querySelector('.loading-spinner');
                btn.disabled = loading;
                if (loading) {
                    txt.style.display = 'none';
                    spin.style.display = 'block';
                } else {
                    txt.style.display = 'inline-flex';
                    spin.style.display = 'none';
                }
            }

            // ENV√çO DE PAGO
            document.getElementById('form-pago').addEventListener('submit', async (e) => {
                e.preventDefault();
                const errorEl = document.getElementById('error-message-pago');
                errorEl.style.display = 'none';

                if (!validateEmail('email-pago', 'confirm-email-pago', errorEl)) return;
                if (cart.length === 0) {
                    errorEl.textContent = "Haz clic en los productos para agregarlos al carrito.";
                    errorEl.style.display = 'block';
                    return;
                }
                if (!validateFile('comprobante-pago', errorEl)) return;

                const btn = e.target.querySelector('.submit-button');
                setLoading(btn, true);

                try {
                    // CONSTRUCCI√ìN DE LA DIRECCI√ìN
                    const calle = document.getElementById('addr-calle').value;
                    const ext = document.getElementById('addr-ext').value;
                    const int = document.getElementById('addr-int').value;
                    const col = document.getElementById('addr-colonia').value;
                    const cp = document.getElementById('addr-cp').value;
                    const ciudad = document.getElementById('addr-ciudad').value;
                    const estado = document.getElementById('addr-estado').value;
                    
                    const direccionCompleta = `${calle} Num. ${ext} ${int ? 'Int. '+int : ''}, Col. ${col}, CP ${cp}, ${ciudad}, ${estado}`;

                    const orderNum = generateOrderNumber(cart[0].name, 'P');
                    const fd = new FormData();
                    fd.append('tipo_de_pago', 'PAGO_COMPLETO');
                    fd.append('orden', orderNum);
                    fd.append('nombre', document.getElementById('nombre-pago').value);
                    fd.append('instagram', document.getElementById('instagram-pago').value.replace('@',''));
                    fd.append('email', document.getElementById('email-pago').value);
                    fd.append('telefono', document.getElementById('telefono-pago').value);
                    fd.append('direccion', direccionCompleta);
                    fd.append('pedido', cart.map(i => `${i.name} (x${i.quantity})`).join(', '));
                    fd.append('total', totalPriceEl.textContent);
                    fd.append('hora_de_pago', new Date().toISOString());
                    fd.append('comprobante', document.getElementById('comprobante-pago').files[0]);

                    const res = await fetch(webhookUrl, { method: 'POST', body: fd });
                    if (!res.ok) throw new Error('Error al enviar');

                    document.getElementById('success-order-number').textContent = orderNum;
                    document.getElementById('success-modal').style.display = 'flex';

                } catch (err) {
                    console.error(err);
                    errorEl.textContent = "Hubo un problema de conexi√≥n. Intenta de nuevo.";
                    errorEl.style.display = 'block';
                } finally {
                    setLoading(btn, false);
                }
            });

            // ENV√çO DE APARTADO
            document.getElementById('form-apartado').addEventListener('submit', async (e) => {
                e.preventDefault();
                const errorEl = document.getElementById('error-message-apartado');
                errorEl.style.display = 'none';

                if (!validateEmail('email-apartado', 'confirm-email-apartado', errorEl)) return;
                
                // Validaci√≥n con input oculto
                const selectedId = document.getElementById('selected-hat-apartado-id').value;
                if (!selectedId) {
                    errorEl.textContent = "Selecciona qu√© vas a apartar (Haz clic en la imagen).";
                    errorEl.style.display = 'block';
                    return;
                }
                
                if (!validateFile('comprobante-apartado', errorEl)) return;

                const btn = e.target.querySelector('.submit-button');
                setLoading(btn, true);

                try {
                    const hat = hatData.find(h => h.id == selectedId);
                    const hatName = hat ? hat.name : "Desconocido";

                    const orderNum = generateOrderNumber(hatName, 'A');
                    const fd = new FormData();
                    fd.append('tipo_de_pago', 'APARTADO');
                    fd.append('orden', orderNum);
                    fd.append('nombre', document.getElementById('nombre-apartado').value);
                    fd.append('instagram', document.getElementById('instagram-apartado').value.replace('@',''));
                    fd.append('email', document.getElementById('email-apartado').value);
                    fd.append('telefono', document.getElementById('telefono-apartado').value);
                    fd.append('gorra_apartada', hatName);
                    fd.append('hora_de_pago', new Date().toISOString());
                    fd.append('comprobante', document.getElementById('comprobante-apartado').files[0]);

                    const res = await fetch(webhookUrl, { method: 'POST', body: fd });
                    if (!res.ok) throw new Error('Error al enviar');

                    document.getElementById('success-order-number').textContent = orderNum;
                    document.getElementById('success-modal').style.display = 'flex';

                } catch (err) {
                    console.error(err);
                    errorEl.textContent = "Error de conexi√≥n. Intenta de nuevo.";
                    errorEl.style.display = 'block';
                } finally {
                    setLoading(btn, false);
                }
            });

            // Cerrar Modal Success
            document.getElementById('success-close-button').addEventListener('click', () => {
                location.reload(); // Recargar para limpiar todo fresco
            });
        });
    </script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
</body>
</html>
